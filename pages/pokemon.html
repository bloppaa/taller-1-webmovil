<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokémon - WebMóvil</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body class="bg-gradient-to-br from-blue-400 to-purple-600 min-h-screen">
    <!-- Header -->
    <header class="bg-yellow-500 text-black p-4 shadow-md">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-bold">⚡Pokédex</h1>
                <p class="text-sm">Descubre el mundo Pokémon</p>
            </div>
            <button onclick="window.location.href='../index.html'" 
                    class="bg-yellow-600 hover:bg-yellow-700 text-black px-4 py-2 rounded transition">
                ← Volver al inicio
            </button>
        </div>
    </header>

    <!-- Barra de búsqueda -->
    <div class="bg-white bg-opacity-20 backdrop-blur-md p-4 shadow-sm">
        <div class="max-w-4xl mx-auto">
            <div class="flex gap-2">
                <input type="text" 
                       id="searchInput" 
                       placeholder="Buscar Pokémon por nombre o número..."
                       class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
                <button onclick="searchPokemon()" 
                        class="bg-yellow-500 hover:bg-yellow-600 text-black px-6 py-3 rounded-lg transition font-semibold">
                    Buscar
                </button>
                <button onclick="loadRandomPokemon()" 
                        class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg transition font-semibold">
                    Aleatorio
                </button>
            </div>
        </div>
    </div>

    <!-- Contenido principal -->
    <main class="max-w-6xl mx-auto p-4">
        <!-- Loading indicator -->
        <div id="loading" class="hidden text-center py-8">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-yellow-500"></div>
            <p class="mt-2 text-white">Cargando Pokémon...</p>
        </div>

        <!-- Error message -->
        <div id="error" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
            <span id="errorMessage"></span>
        </div>

        <!-- Pokemon grid -->
        <div id="pokemonGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mt-6">
        </div>
        <div class="text-center mt-8">
            <button id="loadMoreBtn" onclick="loadMorePokemon()" 
                    class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-lg transition font-semibold">
                Cargar más Pokémon
            </button>
        </div>
    </main>

    <!-- Modal para detalles de Pokémon -->
    <div id="pokemonModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-start mb-4">
                    <h2 id="modalTitle" class="text-2xl font-bold text-gray-800"></h2>
                    <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                <div id="modalContent">
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        let currentOffset = 0;
        const limit = 20;

        // Inicializar cuando se carga la página
        document.addEventListener('DOMContentLoaded', function() {
            loadInitialPokemon();
            
            // Permitir buscar con Enter
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchPokemon();
                }
            });
        });

        // Mostrar loading
        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('error').classList.add('hidden');
        }

        // Ocultar loading
        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        // Mostrar error
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('error').classList.remove('hidden');
            hideLoading();
        }

        // Cargar Pokémon iniciales
        async function loadInitialPokemon() {
            showLoading();
            try {
                await loadPokemonBatch(0, limit);
                currentOffset = limit;
                hideLoading();
            } catch (error) {
                showError('Error al cargar los Pokémon iniciales');
            }
        }

        // Cargar más Pokémon
        async function loadMorePokemon() {
            showLoading();
            try {
                await loadPokemonBatch(currentOffset, limit, true);
                currentOffset += limit;
                hideLoading();
            } catch (error) {
                showError('Error al cargar más Pokémon');
            }
        }

        // Cargar lote de Pokémon
        async function loadPokemonBatch(offset, limit, append = false) {
            const response = await fetch(`https://pokeapi.co/api/v2/pokemon?offset=${offset}&limit=${limit}`);
            const data = await response.json();
            
            const pokemonDetails = await Promise.all(
                data.results.map(pokemon => fetch(pokemon.url).then(res => res.json()))
            );
            
            displayPokemon(pokemonDetails, append);
        }

        // Buscar Pokémon específico
        async function searchPokemon() {
            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            if (!searchTerm) {
                showError('Por favor ingresa un nombre o número de Pokémon');
                return;
            }

            showLoading();
            try {
                const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${searchTerm}`);
                if (!response.ok) {
                    throw new Error('Pokémon no encontrado');
                }
                const pokemon = await response.json();
                displayPokemon([pokemon], false);
                hideLoading();
            } catch (error) {
                showError('Pokémon no encontrado. Verifica el nombre o número.');
            }
        }

        // Cargar Pokémon aleatorio
        async function loadRandomPokemon() {
            showLoading();
            try {
                const randomId = Math.floor(Math.random() * 1010) + 1; // Hasta Gen 9
                const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${randomId}`);
                const pokemon = await response.json();
                displayPokemon([pokemon], false);
                hideLoading();
            } catch (error) {
                showError('Error al cargar Pokémon aleatorio');
            }
        }

        // Mostrar Pokémon en el grid
        function displayPokemon(pokemonList, append) {
            const grid = document.getElementById('pokemonGrid');
            
            if (!append) {
                grid.innerHTML = '';
            }
            
            pokemonList.forEach(pokemon => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition cursor-pointer transform hover:scale-105';
                card.onclick = () => showPokemonDetails(pokemon);
                
                const types = pokemon.types.map(type => 
                    `<span class="px-2 py-1 rounded text-xs font-semibold ${getTypeColor(type.type.name)}">${type.type.name}</span>`
                ).join(' ');
                
                card.innerHTML = `
                    <div class="bg-gradient-to-br ${getTypeGradient(pokemon.types[0].type.name)} p-4">
                        <img src="${pokemon.sprites.other['official-artwork'].front_default || pokemon.sprites.front_default}" 
                             alt="${pokemon.name}" 
                             class="w-full h-32 object-contain">
                    </div>
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-bold text-lg capitalize">${pokemon.name}</h3>
                            <span class="text-gray-500 text-sm">#${pokemon.id.toString().padStart(3, '0')}</span>
                        </div>
                        <div class="flex gap-1 mb-2">
                            ${types}
                        </div>
                        <div class="text-sm text-gray-600">
                            <div>Altura: ${pokemon.height / 10} m</div>
                            <div>Peso: ${pokemon.weight / 10} kg</div>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // Mostrar detalles del Pokémon
        function showPokemonDetails(pokemon) {
            document.getElementById('modalTitle').textContent = 
                `${pokemon.name.charAt(0).toUpperCase() + pokemon.name.slice(1)} #${pokemon.id}`;
            
            const stats = pokemon.stats.map(stat => `
                <div class="flex justify-between items-center py-1">
                    <span class="capitalize">${stat.stat.name}:</span>
                    <div class="flex items-center gap-2">
                        <div class="bg-gray-200 rounded-full h-2 w-24">
                            <div class="bg-blue-500 h-2 rounded-full" style="width: ${Math.min(stat.base_stat / 255 * 100, 100)}%"></div>
                        </div>
                        <span class="text-sm font-semibold w-8">${stat.base_stat}</span>
                    </div>
                </div>
            `).join('');

            const abilities = pokemon.abilities.map(ability => 
                `<span class="bg-gray-100 px-2 py-1 rounded text-sm">${ability.ability.name}</span>`
            ).join(' ');

            document.getElementById('modalContent').innerHTML = `
                <div class="text-center mb-4">
                    <img src="${pokemon.sprites.other['official-artwork'].front_default || pokemon.sprites.front_default}" 
                         alt="${pokemon.name}" 
                         class="w-48 h-48 mx-auto object-contain">
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <h4 class="font-semibold mb-2">Información básica:</h4>
                        <div class="space-y-1 text-sm">
                            <div><strong>Altura:</strong> ${pokemon.height / 10} m</div>
                            <div><strong>Peso:</strong> ${pokemon.weight / 10} kg</div>
                            <div><strong>Experiencia base:</strong> ${pokemon.base_experience}</div>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2">Habilidades:</h4>
                        <div class="flex flex-wrap gap-1">
                            ${abilities}
                        </div>
                    </div>
                </div>

                <div class="mb-4">
                    <h4 class="font-semibold mb-2">Estadísticas:</h4>
                    ${stats}
                </div>

                <div class="mt-4 flex justify-end">
                    <button onclick="closeModal()" 
                            class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded transition">
                        Cerrar
                    </button>
                </div>
            `;
            
            document.getElementById('pokemonModal').classList.remove('hidden');
        }

        // Cerrar modal
        function closeModal() {
            document.getElementById('pokemonModal').classList.add('hidden');
        }

        // Obtener color del tipo
        function getTypeColor(type) {
            const colors = {
                normal: 'bg-gray-400 text-white',
                fire: 'bg-red-500 text-white',
                water: 'bg-blue-500 text-white',
                electric: 'bg-yellow-400 text-black',
                grass: 'bg-green-500 text-white',
                ice: 'bg-blue-300 text-black',
                fighting: 'bg-red-700 text-white',
                poison: 'bg-purple-500 text-white',
                ground: 'bg-yellow-600 text-white',
                flying: 'bg-indigo-400 text-white',
                psychic: 'bg-pink-500 text-white',
                bug: 'bg-green-400 text-white',
                rock: 'bg-yellow-800 text-white',
                ghost: 'bg-purple-700 text-white',
                dragon: 'bg-indigo-700 text-white',
                dark: 'bg-gray-800 text-white',
                steel: 'bg-gray-500 text-white',
                fairy: 'bg-pink-300 text-black'
            };
            return colors[type] || 'bg-gray-400 text-white';
        }
        function getTypeGradient(type) {
            const gradients = {
                normal: 'from-gray-300 to-gray-400',
                fire: 'from-red-400 to-orange-500',
                water: 'from-blue-400 to-blue-600',
                electric: 'from-yellow-300 to-yellow-500',
                grass: 'from-green-400 to-green-600',
                ice: 'from-blue-200 to-blue-400',
                fighting: 'from-red-600 to-red-800',
                poison: 'from-purple-400 to-purple-600',
                ground: 'from-yellow-500 to-yellow-700',
                flying: 'from-indigo-300 to-indigo-500',
                psychic: 'from-pink-400 to-pink-600',
                bug: 'from-green-300 to-green-500',
                rock: 'from-yellow-700 to-yellow-900',
                ghost: 'from-purple-600 to-purple-800',
                dragon: 'from-indigo-600 to-indigo-800',
                dark: 'from-gray-700 to-gray-900',
                steel: 'from-gray-400 to-gray-600',
                fairy: 'from-pink-200 to-pink-400'
            };
            return gradients[type] || 'from-gray-300 to-gray-400';
        }

        // Cerrar modal al hacer clic fuera
        document.getElementById('pokemonModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>
